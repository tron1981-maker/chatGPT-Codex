<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Solar System with Trails</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            color: #fff;
        }

        #canvas-container {
            width: 100vw;
            height: 100vh;
        }

        #controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.85);
            border: 2px solid #444;
            padding: 15px;
            border-radius: 8px;
            z-index: 100;
            font-size: 12px;
            min-width: 200px;
        }

        #controls h3 {
            color: #ffcc00;
            margin-bottom: 10px;
            font-size: 14px;
            text-shadow: 2px 2px #000;
        }

        .control-row {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-row label {
            min-width: 80px;
            color: #aaa;
        }

        input[type="range"] {
            width: 80px;
            cursor: pointer;
        }

        button {
            background: #333;
            color: #fff;
            border: 2px solid #666;
            padding: 6px 12px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            transition: all 0.2s;
            border-radius: 4px;
        }

        button:hover {
            background: #555;
            border-color: #888;
        }

        button:active {
            background: #222;
        }

        button.active {
            background: #ffcc00;
            color: #000;
            border-color: #ffcc00;
        }

        #instructions {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.85);
            border: 2px solid #444;
            padding: 15px;
            font-size: 11px;
            color: #888;
            z-index: 100;
            border-radius: 8px;
        }

        #instructions h4 {
            color: #ffcc00;
            margin-bottom: 8px;
        }

        #instructions p {
            margin: 4px 0;
        }

        .key {
            background: #333;
            padding: 2px 6px;
            border: 1px solid #555;
            color: #fff;
            border-radius: 3px;
        }

        #info-panel {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ffcc00;
            padding: 15px;
            min-width: 280px;
            display: none;
            z-index: 100;
            border-radius: 8px;
        }

        #info-panel h2 {
            color: #ffcc00;
            margin-bottom: 10px;
            font-size: 16px;
        }

        #info-panel p {
            margin: 5px 0;
            font-size: 11px;
            color: #ccc;
        }

        #info-panel .planet-color {
            display: inline-block;
            width: 14px;
            height: 14px;
            margin-right: 8px;
            vertical-align: middle;
            border-radius: 50%;
        }

        #fps {
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: #666;
            font-size: 10px;
        }

        .view-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }

        .view-buttons button {
            flex: 1;
            min-width: 45%;
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>

    <div id="controls">
        <h3>Control Panel</h3>
        <div class="control-row">
            <label>Speed:</label>
            <input type="range" id="speed" min="0" max="5" step="0.1" value="1">
            <span id="speed-val">1x</span>
        </div>
        <div class="control-row">
            <label>Trail Length:</label>
            <input type="range" id="trail-length" min="0" max="500" step="10" value="200">
            <span id="trail-val">200</span>
        </div>
        <div class="control-row">
            <button id="toggle-trails" class="active">Trails ON</button>
            <button id="toggle-orbits">Orbits ON</button>
        </div>
        <div class="control-row">
            <button id="toggle-names">Names ON</button>
            <button id="toggle-pause">Pause</button>
        </div>
        <div class="control-row">
            <label>View:</label>
        </div>
        <div class="view-buttons">
            <button id="view-top">Top</button>
            <button id="view-side">Side</button>
            <button id="view-angle">Angle</button>
            <button id="view-reset">Reset</button>
        </div>
    </div>

    <div id="instructions">
        <h4>Controls</h4>
        <p><span class="key">Left Drag</span> Rotate View</p>
        <p><span class="key">Right Drag</span> Pan</p>
        <p><span class="key">Scroll</span> Zoom In/Out</p>
        <p><span class="key">Click</span> Select Planet</p>
        <p><span class="key">Space</span> Pause/Play</p>
        <p><span class="key">R</span> Reset View</p>
    </div>

    <div id="info-panel">
        <h2 id="planet-name">Planet</h2>
        <p><span class="planet-color" id="planet-color-box"></span><span id="planet-type"></span></p>
        <p id="planet-desc"></p>
        <p>Temperature: <span id="planet-temp"></span></p>
        <p>Size (vs Earth): <span id="planet-size"></span></p>
        <p>Orbit Period: <span id="planet-orbit"></span></p>
        <p>Moons: <span id="planet-moons"></span></p>
    </div>

    <div id="fps">FPS: <span id="fps-val">60</span></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Scene setup
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 10000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });

        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        container.appendChild(renderer.domElement);

        // State variables
        let time = 0;
        let speedMultiplier = 1;
        let showTrails = true;
        let showOrbits = true;
        let showNames = true;
        let isPaused = false;
        let trailLength = 200;
        let selectedPlanet = null;

        // Camera controls
        let isDragging = false;
        let isPanning = false;
        let previousMousePosition = { x: 0, y: 0 };
        let cameraDistance = 800;
        let cameraTheta = Math.PI / 4;  // Horizontal angle
        let cameraPhi = Math.PI / 4;    // Vertical angle
        let cameraTarget = new THREE.Vector3(0, 0, 0);

        // Planet data
        const planetsData = [
            {
                name: 'Sun',
                nameKo: '태양',
                type: 'Star',
                color: 0xffcc00,
                emissive: 0xffaa00,
                size: 40,
                orbitRadius: 0,
                orbitSpeed: 0,
                angle: 0,
                description: 'The star at the center of our solar system',
                temp: '5,500°C (surface)',
                sizeRatio: '109x',
                orbitPeriod: '-',
                moons: '-',
                isSun: true
            },
            {
                name: 'Mercury',
                nameKo: '수성',
                type: 'Rocky Planet',
                color: 0x8c8c8c,
                size: 5,
                orbitRadius: 70,
                orbitSpeed: 0.04,
                angle: Math.random() * Math.PI * 2,
                description: 'The closest planet to the Sun',
                temp: '-180 to 430°C',
                sizeRatio: '0.38x',
                orbitPeriod: '88 days',
                moons: '0'
            },
            {
                name: 'Venus',
                nameKo: '금성',
                type: 'Rocky Planet',
                color: 0xe6c35c,
                size: 8,
                orbitRadius: 110,
                orbitSpeed: 0.015,
                angle: Math.random() * Math.PI * 2,
                description: 'A hot planet similar in size to Earth',
                temp: '462°C',
                sizeRatio: '0.95x',
                orbitPeriod: '225 days',
                moons: '0'
            },
            {
                name: 'Earth',
                nameKo: '지구',
                type: 'Rocky Planet',
                color: 0x4d94ff,
                size: 9,
                orbitRadius: 160,
                orbitSpeed: 0.01,
                angle: Math.random() * Math.PI * 2,
                description: 'Our home, the blue planet',
                temp: '15°C',
                sizeRatio: '1x',
                orbitPeriod: '365 days',
                moons: '1'
            },
            {
                name: 'Mars',
                nameKo: '화성',
                type: 'Rocky Planet',
                color: 0xcc4422,
                size: 6,
                orbitRadius: 220,
                orbitSpeed: 0.008,
                angle: Math.random() * Math.PI * 2,
                description: 'The red desert planet',
                temp: '-65°C',
                sizeRatio: '0.53x',
                orbitPeriod: '687 days',
                moons: '2'
            },
            {
                name: 'Jupiter',
                nameKo: '목성',
                type: 'Gas Giant',
                color: 0xd4a574,
                size: 25,
                orbitRadius: 350,
                orbitSpeed: 0.002,
                angle: Math.random() * Math.PI * 2,
                description: 'The largest planet in our solar system',
                temp: '-110°C',
                sizeRatio: '11.2x',
                orbitPeriod: '12 years',
                moons: '95'
            },
            {
                name: 'Saturn',
                nameKo: '토성',
                type: 'Gas Giant',
                color: 0xe6d4a8,
                size: 22,
                orbitRadius: 450,
                orbitSpeed: 0.0009,
                angle: Math.random() * Math.PI * 2,
                hasRing: true,
                description: 'The ringed planet',
                temp: '-140°C',
                sizeRatio: '9.4x',
                orbitPeriod: '29 years',
                moons: '146'
            },
            {
                name: 'Uranus',
                nameKo: '천왕성',
                type: 'Ice Giant',
                color: 0x7de3e3,
                size: 14,
                orbitRadius: 550,
                orbitSpeed: 0.0004,
                angle: Math.random() * Math.PI * 2,
                description: 'The tilted ice giant',
                temp: '-195°C',
                sizeRatio: '4x',
                orbitPeriod: '84 years',
                moons: '28'
            },
            {
                name: 'Neptune',
                nameKo: '해왕성',
                type: 'Ice Giant',
                color: 0x4169e1,
                size: 13,
                orbitRadius: 650,
                orbitSpeed: 0.0002,
                angle: Math.random() * Math.PI * 2,
                description: 'The windiest planet',
                temp: '-200°C',
                sizeRatio: '3.9x',
                orbitPeriod: '165 years',
                moons: '16'
            }
        ];

        // 3D Objects storage
        const planets = [];
        const trails = [];
        const orbitLines = [];
        const nameLabels = [];

        // Create starfield background
        function createStarfield() {
            const starsGeometry = new THREE.BufferGeometry();
            const starsMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 1.5,
                sizeAttenuation: true
            });

            const starsVertices = [];
            for (let i = 0; i < 5000; i++) {
                const x = (Math.random() - 0.5) * 4000;
                const y = (Math.random() - 0.5) * 4000;
                const z = (Math.random() - 0.5) * 4000;
                starsVertices.push(x, y, z);
            }

            starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
            const starField = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(starField);
        }

        // Create orbit line
        function createOrbitLine(radius) {
            const segments = 128;
            const points = [];

            for (let i = 0; i <= segments; i++) {
                const angle = (i / segments) * Math.PI * 2;
                points.push(new THREE.Vector3(
                    Math.cos(angle) * radius,
                    0,
                    Math.sin(angle) * radius
                ));
            }

            const geometry = new THREE.BufferGeometry().setFromPoints(points);
            const material = new THREE.LineBasicMaterial({
                color: 0xffffff,
                transparent: true,
                opacity: 0.15
            });
            const line = new THREE.Line(geometry, material);
            scene.add(line);
            orbitLines.push(line);
            return line;
        }

        // Create planet
        function createPlanet(data, index) {
            const geometry = new THREE.SphereGeometry(data.size, 32, 32);
            let material;

            if (data.isSun) {
                material = new THREE.MeshBasicMaterial({
                    color: data.color,
                    emissive: data.emissive
                });

                // Add glow effect for sun
                const glowGeometry = new THREE.SphereGeometry(data.size * 1.3, 32, 32);
                const glowMaterial = new THREE.MeshBasicMaterial({
                    color: 0xffaa00,
                    transparent: true,
                    opacity: 0.3
                });
                const glow = new THREE.Mesh(glowGeometry, glowMaterial);
                scene.add(glow);

                // Add point light from sun
                const sunLight = new THREE.PointLight(0xffffee, 2, 2000);
                scene.add(sunLight);
            } else {
                material = new THREE.MeshStandardMaterial({
                    color: data.color,
                    roughness: 0.8,
                    metalness: 0.2
                });
            }

            const planet = new THREE.Mesh(geometry, material);
            planet.userData = { ...data, index };
            scene.add(planet);

            // Saturn's ring
            if (data.hasRing) {
                const ringGeometry = new THREE.RingGeometry(data.size * 1.4, data.size * 2.2, 64);
                const ringMaterial = new THREE.MeshBasicMaterial({
                    color: 0xc4a868,
                    transparent: true,
                    opacity: 0.6,
                    side: THREE.DoubleSide
                });
                const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                ring.rotation.x = Math.PI / 2.5;
                planet.add(ring);
            }

            // Create trail
            const trailPositions = [];
            for (let i = 0; i < trailLength; i++) {
                trailPositions.push(0, 0, 0);
            }
            const trailGeometry = new THREE.BufferGeometry();
            trailGeometry.setAttribute('position', new THREE.Float32BufferAttribute(trailPositions, 3));

            const trailMaterial = new THREE.LineBasicMaterial({
                color: data.color,
                transparent: true,
                opacity: 0.7
            });
            const trail = new THREE.Line(trailGeometry, trailMaterial);
            trail.userData = {
                positions: [],
                maxLength: trailLength,
                color: data.color
            };
            scene.add(trail);
            trails.push(trail);

            planets.push(planet);

            // Create orbit line
            if (data.orbitRadius > 0) {
                createOrbitLine(data.orbitRadius);
            }

            return planet;
        }

        // Create text sprite for names
        function createTextSprite(text, color) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 256;
            canvas.height = 64;

            context.font = 'Bold 32px Courier New';
            context.fillStyle = color;
            context.textAlign = 'center';
            context.fillText(text, 128, 40);

            const texture = new THREE.CanvasTexture(canvas);
            const spriteMaterial = new THREE.SpriteMaterial({
                map: texture,
                transparent: true,
                opacity: 0.8
            });
            const sprite = new THREE.Sprite(spriteMaterial);
            sprite.scale.set(50, 15, 1);
            scene.add(sprite);
            nameLabels.push(sprite);
            return sprite;
        }

        // Initialize scene
        function initScene() {
            // Ambient light
            const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
            scene.add(ambientLight);

            // Create starfield
            createStarfield();

            // Create planets
            planetsData.forEach((data, index) => {
                createPlanet(data, index);
                if (data.orbitRadius > 0) {
                    createTextSprite(data.name, '#' + data.color.toString(16).padStart(6, '0'));
                }
            });

            // Initial camera position
            updateCameraPosition();
        }

        // Update camera position based on spherical coordinates
        function updateCameraPosition() {
            camera.position.x = cameraTarget.x + cameraDistance * Math.sin(cameraPhi) * Math.cos(cameraTheta);
            camera.position.y = cameraTarget.y + cameraDistance * Math.cos(cameraPhi);
            camera.position.z = cameraTarget.z + cameraDistance * Math.sin(cameraPhi) * Math.sin(cameraTheta);
            camera.lookAt(cameraTarget);
        }

        // Update planet positions
        function updatePlanets() {
            planets.forEach((planet, index) => {
                const data = planetsData[index];

                if (!isPaused) {
                    data.angle += data.orbitSpeed * speedMultiplier;
                }

                const x = Math.cos(data.angle) * data.orbitRadius;
                const z = Math.sin(data.angle) * data.orbitRadius;

                planet.position.set(x, 0, z);
                planet.rotation.y += 0.01 * speedMultiplier;

                // Update trail
                if (data.orbitRadius > 0 && showTrails) {
                    const trail = trails[index];
                    const positions = trail.userData.positions;

                    positions.unshift({ x, y: 0, z });
                    if (positions.length > trail.userData.maxLength) {
                        positions.pop();
                    }

                    const posArray = [];
                    positions.forEach(pos => {
                        posArray.push(pos.x, pos.y, pos.z);
                    });

                    trail.geometry.setAttribute('position',
                        new THREE.Float32BufferAttribute(posArray, 3));
                    trail.geometry.attributes.position.needsUpdate = true;
                }

                // Update name label position
                if (nameLabels[index - 1]) {
                    nameLabels[index - 1].position.set(x, data.size + 15, z);
                    nameLabels[index - 1].visible = showNames;
                }
            });

            // Update orbit visibility
            orbitLines.forEach(line => {
                line.visible = showOrbits;
            });

            // Update trail visibility
            trails.forEach(trail => {
                trail.visible = showTrails;
            });
        }

        // Handle window resize
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Mouse events for camera rotation
        function onMouseDown(event) {
            if (event.button === 0) { // Left click
                isDragging = true;
            } else if (event.button === 2) { // Right click
                isPanning = true;
            }
            previousMousePosition = { x: event.clientX, y: event.clientY };
        }

        function onMouseMove(event) {
            if (isDragging) {
                const deltaX = event.clientX - previousMousePosition.x;
                const deltaY = event.clientY - previousMousePosition.y;

                cameraTheta -= deltaX * 0.01;
                cameraPhi -= deltaY * 0.01;

                // Clamp phi to prevent flipping
                cameraPhi = Math.max(0.1, Math.min(Math.PI - 0.1, cameraPhi));

                updateCameraPosition();
            } else if (isPanning) {
                const deltaX = event.clientX - previousMousePosition.x;
                const deltaY = event.clientY - previousMousePosition.y;

                const right = new THREE.Vector3();
                const up = new THREE.Vector3(0, 1, 0);
                camera.getWorldDirection(right);
                right.cross(up).normalize();

                cameraTarget.addScaledVector(right, -deltaX * 0.5);
                cameraTarget.y += deltaY * 0.5;

                updateCameraPosition();
            }

            previousMousePosition = { x: event.clientX, y: event.clientY };
        }

        function onMouseUp(event) {
            // Check for planet click
            if (!isDragging || (Math.abs(event.clientX - previousMousePosition.x) < 5 &&
                Math.abs(event.clientY - previousMousePosition.y) < 5)) {
                checkPlanetClick(event);
            }
            isDragging = false;
            isPanning = false;
        }

        function onWheel(event) {
            event.preventDefault();
            cameraDistance += event.deltaY * 0.5;
            cameraDistance = Math.max(100, Math.min(2000, cameraDistance));
            updateCameraPosition();
        }

        // Raycaster for planet selection
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        function checkPlanetClick(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(planets);

            if (intersects.length > 0) {
                const planet = intersects[0].object;
                selectedPlanet = planet.userData;
                updateInfoPanel(planet.userData);
            } else {
                selectedPlanet = null;
                document.getElementById('info-panel').style.display = 'none';
            }
        }

        // Update info panel
        function updateInfoPanel(data) {
            document.getElementById('info-panel').style.display = 'block';
            document.getElementById('planet-name').textContent = `${data.name} (${data.nameKo})`;
            document.getElementById('planet-type').textContent = data.type;
            document.getElementById('planet-color-box').style.backgroundColor = '#' + data.color.toString(16).padStart(6, '0');
            document.getElementById('planet-desc').textContent = data.description;
            document.getElementById('planet-temp').textContent = data.temp;
            document.getElementById('planet-size').textContent = data.sizeRatio;
            document.getElementById('planet-orbit').textContent = data.orbitPeriod;
            document.getElementById('planet-moons').textContent = data.moons;
        }

        // FPS counter
        let lastTime = performance.now();
        let frameCount = 0;

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);

            if (!isPaused) {
                time += speedMultiplier;
            }

            updatePlanets();
            renderer.render(scene, camera);

            // FPS calculation
            frameCount++;
            const currentTime = performance.now();
            if (currentTime - lastTime >= 1000) {
                document.getElementById('fps-val').textContent = frameCount;
                frameCount = 0;
                lastTime = currentTime;
            }
        }

        // Event listeners
        window.addEventListener('resize', onWindowResize);
        renderer.domElement.addEventListener('mousedown', onMouseDown);
        renderer.domElement.addEventListener('mousemove', onMouseMove);
        renderer.domElement.addEventListener('mouseup', onMouseUp);
        renderer.domElement.addEventListener('wheel', onWheel, { passive: false });
        renderer.domElement.addEventListener('contextmenu', (e) => e.preventDefault());

        // Control panel events
        document.getElementById('speed').addEventListener('input', (e) => {
            speedMultiplier = parseFloat(e.target.value);
            document.getElementById('speed-val').textContent = speedMultiplier.toFixed(1) + 'x';
        });

        document.getElementById('trail-length').addEventListener('input', (e) => {
            trailLength = parseInt(e.target.value);
            document.getElementById('trail-val').textContent = trailLength;
            trails.forEach(trail => {
                trail.userData.maxLength = trailLength;
            });
        });

        document.getElementById('toggle-trails').addEventListener('click', (e) => {
            showTrails = !showTrails;
            e.target.textContent = showTrails ? 'Trails ON' : 'Trails OFF';
            e.target.classList.toggle('active', showTrails);
        });

        document.getElementById('toggle-orbits').addEventListener('click', (e) => {
            showOrbits = !showOrbits;
            e.target.textContent = showOrbits ? 'Orbits ON' : 'Orbits OFF';
            e.target.classList.toggle('active', showOrbits);
        });

        document.getElementById('toggle-names').addEventListener('click', (e) => {
            showNames = !showNames;
            e.target.textContent = showNames ? 'Names ON' : 'Names OFF';
            e.target.classList.toggle('active', showNames);
        });

        document.getElementById('toggle-pause').addEventListener('click', (e) => {
            isPaused = !isPaused;
            e.target.textContent = isPaused ? 'Play' : 'Pause';
            e.target.classList.toggle('active', isPaused);
        });

        // View buttons
        document.getElementById('view-top').addEventListener('click', () => {
            cameraPhi = 0.1;
            cameraTheta = 0;
            updateCameraPosition();
        });

        document.getElementById('view-side').addEventListener('click', () => {
            cameraPhi = Math.PI / 2;
            cameraTheta = 0;
            updateCameraPosition();
        });

        document.getElementById('view-angle').addEventListener('click', () => {
            cameraPhi = Math.PI / 4;
            cameraTheta = Math.PI / 4;
            updateCameraPosition();
        });

        document.getElementById('view-reset').addEventListener('click', () => {
            cameraDistance = 800;
            cameraPhi = Math.PI / 4;
            cameraTheta = Math.PI / 4;
            cameraTarget.set(0, 0, 0);
            updateCameraPosition();
        });

        // Keyboard events
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                isPaused = !isPaused;
                const btn = document.getElementById('toggle-pause');
                btn.textContent = isPaused ? 'Play' : 'Pause';
                btn.classList.toggle('active', isPaused);
            } else if (e.code === 'KeyR') {
                cameraDistance = 800;
                cameraPhi = Math.PI / 4;
                cameraTheta = Math.PI / 4;
                cameraTarget.set(0, 0, 0);
                updateCameraPosition();
            }
        });

        // Initialize and start
        initScene();
        animate();
    </script>
</body>
</html>
